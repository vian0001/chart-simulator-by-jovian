<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeSim Pro - Simulator Trading</title>
    
    <!-- Chart.js dan LightWeight Charts untuk candlestick -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>


/* Styles for multi-chart layout */
.chart-tabs {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.tab-navigation {
    display: flex;
    background: rgba(26, 32, 44, 0.8);
    border-radius: 10px 10px 0 0;
    overflow: hidden;
}

.tab-button {
    padding: 12px 20px;
    background: transparent;
    border: none;
    color: #a0aec0;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.tab-button:hover {
    color: #ffffff;
}

.tab-button.active {
    color: #00d4aa;
    background: rgba(0, 212, 170, 0.1);
}

.tab-button.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    width: 100%;
    background: #00d4aa;
}

.tab-add {
    padding: 12px 15px;
    background: transparent;
    border: none;
    color: #a0aec0;
    cursor: pointer;
    margin-left: auto;
    transition: all 0.3s ease;
}

.tab-add:hover {
    color: #00d4aa;
}

.tab-content {
    flex: 1;
    position: relative;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 0 0 15px 15px;
}

.tab-pane {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    padding: 15px;
}

.tab-pane.active {
    display: block;
}

.positions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    height: 100%;
    overflow-y: auto;
}

.position-chart-card {
    background: rgba(26, 32, 44, 0.8);
    border-radius: 15px;
    border: 2px solid rgba(0, 212, 170, 0.2);
    overflow: hidden;
    height: 350px;
    display: flex;
    flex-direction: column;
}

.position-chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.position-chart-title {
    font-weight: bold;
    font-size: 1.1rem;
}

.position-chart-body {
    flex: 1;
    position: relative;
}

.multi-chart-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 15px;
    height: 100%;
}

.multi-chart-item {
    background: rgba(26, 32, 44, 0.8);
    border-radius: 15px;
    border: 2px solid rgba(0, 212, 170, 0.2);
    overflow: hidden;
}

/* TP/SL Input Group */
.tp-sl-input-group {
    display: flex;
    gap: 10px;
}

.tp-sl-type {
    flex: 1;
}

.tp-sl-value {
    flex: 1;
}

/* Create custom coin button */
.create-coin-btn {
    padding: 0.8rem 1.2rem;
    background: linear-gradient(135deg, #00d4aa, #00b894);
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.create-coin-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 212, 170, 0.3);
}

/* Analytics styling */
.analytics-dashboard {
    background: rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    border-radius: 20px;
    margin-top: 1.5rem;
    border: 1px solid rgba(0, 212, 170, 0.2);
}

.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.analytics-card {
    background: rgba(26, 32, 44, 0.8);
    padding: 1.2rem;
    border-radius: 15px;
    text-align: center;
    border: 2px solid rgba(0, 212, 170, 0.2);
    transition: all 0.3s ease;
}

.analytics-title {
    color: #a0aec0;
    font-size: 0.9rem;
    margin-bottom: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.analytics-value {
    color: #00d4aa;
    font-size: 1.5rem;
    font-weight: bold;
    text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
}

.portfolio-chart {
    height: 200px;
    background: rgba(26, 32, 44, 0.8);
    border-radius: 15px;
    border: 1px solid rgba(0, 212, 170, 0.2);
}

/* Info tooltips */
.info-tooltip {
    display: inline-block;
    width: 18px;
    height: 18px;
    line-height: 18px;
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    color: #a0aec0;
    font-size: 0.8rem;
    cursor: help;
}

.info-tooltip:hover {
    background: rgba(0, 212, 170, 0.2);
    color: #00d4aa;
}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e1a, #1a1d29);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(90deg, #00d4aa, #0099cc);
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            padding: 0 2rem 2rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .chart-section {
            background: linear-gradient(135deg, #1a1d29, #2d3748);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid #00d4aa;
            box-shadow: 0 20px 40px rgba(0, 212, 170, 0.15);
            backdrop-filter: blur(10px);
        }

        .trading-panel {
            background: linear-gradient(135deg, #1a1d29, #2d3748);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid #ff6b6b;
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.15);
            backdrop-filter: blur(10px);
            max-height: 800px;
            overflow-y: auto;
        }

        .price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .price-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .symbol-selector {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .symbol {
            font-size: 2rem;
            font-weight: bold;
            color: #00d4aa;
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .coin-select {
            background: #2d3748;
            border: 2px solid #00d4aa;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            color: #fff;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .current-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .price-flicker-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 212, 170, 0.3);
            border-radius: 5px;
            opacity: 0;
            animation: none;
        }

        .price-flicker-buy {
            background: rgba(0, 212, 170, 0.3);
        }
        .price-flicker-sell {
            background: rgba(255, 107, 107, 0.3);
        }

        @keyframes flicker-fade {
            0% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1); }
        }

        .trade-activity {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            max-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            color: #fff;
            font-size: 0.8rem;
            z-index: 10;
        }

        .trade-activity-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: fade-in 0.5s;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .trade-buy {
            color: #00d4aa;
        }

        .trade-sell {
            color: #ff6b6b;
        }

        .price-change {
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .price-up { 
            background: linear-gradient(135deg, #00d4aa, #00b894); 
            color: #000;
            animation: pulse-green 2s infinite;
        }

        .price-down { 
            background: linear-gradient(135deg, #ff6b6b, #e55454); 
            color: #fff;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 212, 170, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 212, 170, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 212, 170, 0); }
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .chart-container {
            height: 450px;
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
            position: relative;
        }

        .chart-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2rem;
            color: #00d4aa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #2d3748;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #00d4aa;
            box-shadow: 0 10px 25px rgba(0, 212, 170, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d4aa, transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stat-title {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            color: #00d4aa;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .wallet-section {
            background: rgba(0, 212, 170, 0.1);
            padding: 2rem;
            border-radius: 20px;
            border: 2px solid rgba(0, 212, 170, 0.3);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .wallet-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 212, 170, 0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .wallet-content {
            position: relative;
            z-index: 2;
        }

        .balance {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 1rem 0;
            color: #00d4aa;
            text-shadow: 0 0 20px rgba(0, 212, 170, 0.5);
        }

        .pnl {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .pnl-positive { 
            color: #00d4aa; 
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .pnl-negative { 
            color: #ff6b6b; 
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
        }

        .wallet-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .wallet-btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            border: 2px solid #4a5568;
            color: #fff;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .topup-btn {
            border-color: #00d4aa;
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: #000;
        }

        .topup-btn:hover {
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.4);
        }

        .withdraw-btn {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff6b6b, #e55454);
            color: #fff;
        }

        .withdraw-btn:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .trading-form {
            background: rgba(0, 0, 0, 0.3);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.8rem;
            color: #a0aec0;
            font-size: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            background: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 12px;
            padding: 1rem 1.2rem;
            color: #fff;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #00d4aa;
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.15);
            background: #3a4553;
        }

        .amount-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .amount-btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            border: 2px solid #4a5568;
            color: #fff;
            padding: 0.8rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .amount-btn:hover {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            border-color: #00d4aa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.3);
        }

        .trade-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .trade-btn {
            padding: 1.5rem;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .trade-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .trade-btn:hover::before {
            left: 100%;
        }

        .buy-btn {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
            box-shadow: 0 10px 25px rgba(0, 212, 170, 0.3);
        }

        .sell-btn {
            background: linear-gradient(135deg, #ff6b6b, #e55454);
            color: white;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .trade-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 35px rgba(0, 0, 0, 0.4);
        }

        .positions {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 20px;
            margin-bottom: 1rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
        }

        .section-title {
            color: #00d4aa;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .position-item {
            background: rgba(45, 55, 72, 0.6);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border-left: 4px solid #00d4aa;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .position-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0, 212, 170, 0.2);
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .position-type {
            font-weight: bold;
            color: #00d4aa;
            font-size: 1.1rem;
        }

        .position-pnl {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .close-btn {
            background: linear-gradient(135deg, #ff6b6b, #e55454);
            border: none;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 1rem;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .close-btn:hover {
            background: linear-gradient(135deg, #e55454, #d63447);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.4s ease;
            z-index: 1000;
            font-weight: bold;
            font-size: 1.1rem;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff6b6b, #e55454);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 212, 170, 0.3);
            border-radius: 50%;
            border-top-color: #00d4aa;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .control-btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            border: 2px solid #4a5568;
            color: #fff;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            border-color: #00d4aa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1d29, #2d3748);
            padding: 2.5rem;
            border-radius: 25px;
            border: 2px solid #00d4aa;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { 
                transform: translateY(50px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(0, 212, 170, 0.2);
        }

        .modal-header h2 {
            color: #00d4aa;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .modal-header p {
            color: #a0aec0;
            font-size: 1rem;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: #a0aec0;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            transform: rotate(90deg);
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
        }

        .modal-btn-secondary {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .history-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 20px;
            margin-bottom: 1rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: rgba(45, 55, 72, 0.3);
            border-radius: 10px;
            border-left: 3px solid;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(45, 55, 72, 0.6);
            transform: translateX(3px);
        }

        .history-deposit {
            border-left-color: #00d4aa;
        }

        .history-withdraw {
            border-left-color: #ff6b6b;
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .history-icon {
            font-size: 1.2rem;
        }

        .history-deposit .history-icon {
            color: #00d4aa;
        }

        .history-withdraw .history-icon {
            color: #ff6b6b;
        }

        .history-details {
            flex: 1;
        }

        .history-type {
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-time {
            font-size: 0.8rem;
            color: #a0aec0;
        }

        .history-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .history-deposit .history-amount {
            color: #00d4aa;
        }

        .history-withdraw .history-amount {
            color: #ff6b6b;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                padding: 0 1rem 1rem 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .current-price {
                font-size: 2rem;
            }
            
            .balance {
                font-size: 2rem;
            }
        }

        @media (max-width: 640px) {
            .price-info {
                flex-direction: column;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .amount-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                width: 95%;
                padding: 2rem;
            }
            
            .wallet-actions {
                grid-template-columns: 1fr;
            }
        }
        /* CSS dari kode asli tidak diubah, hanya ditambahkan beberapa style baru di bawah */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e1a, #1a1d29);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(90deg, #00d4aa, #0099cc);
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            padding: 0 2rem 2rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .chart-section {
            background: linear-gradient(135deg, #1a1d29, #2d3748);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid #00d4aa;
            box-shadow: 0 20px 40px rgba(0, 212, 170, 0.15);
            backdrop-filter: blur(10px);
        }

        .trading-panel {
            background: linear-gradient(135deg, #1a1d29, #2d3748);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid #ff6b6b;
            box-shadow: 0 20px 40px rgba(255, 107, 107, 0.15);
            backdrop-filter: blur(10px);
            max-height: 800px;
            overflow-y: auto;
        }

        .price-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .price-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .symbol-selector {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .symbol {
            font-size: 2rem;
            font-weight: bold;
            color: #00d4aa;
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .coin-select {
            background: #2d3748;
            border: 2px solid #00d4aa;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            color: #fff;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .current-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .price-flicker-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 212, 170, 0.3);
            border-radius: 5px;
            opacity: 0;
            animation: none;
        }

        .price-flicker-buy {
            background: rgba(0, 212, 170, 0.3);
        }
        .price-flicker-sell {
            background: rgba(255, 107, 107, 0.3);
        }

        @keyframes flicker-fade {
            0% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(1); }
        }

        .trade-activity {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            max-width: 200px;
            max-height: 300px;
            overflow-y: auto;
            color: #fff;
            font-size: 0.8rem;
            z-index: 10;
        }

        .trade-activity-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: fade-in 0.5s;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .trade-buy {
            color: #00d4aa;
        }

        .trade-sell {
            color: #ff6b6b;
        }

        .price-change {
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .price-up { 
            background: linear-gradient(135deg, #00d4aa, #00b894); 
            color: #000;
            animation: pulse-green 2s infinite;
        }

        .price-down { 
            background: linear-gradient(135deg, #ff6b6b, #e55454); 
            color: #fff;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 212, 170, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 212, 170, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 212, 170, 0); }
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        .chart-container {
            height: 450px;
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
            position: relative;
        }

        .chart-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2rem;
            color: #00d4aa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #2d3748;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #00d4aa;
            box-shadow: 0 10px 25px rgba(0, 212, 170, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d4aa, transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stat-title {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            color: #00d4aa;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .wallet-section {
            background: rgba(0, 212, 170, 0.1);
            padding: 2rem;
            border-radius: 20px;
            border: 2px solid rgba(0, 212, 170, 0.3);
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .wallet-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 212, 170, 0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .wallet-content {
            position: relative;
            z-index: 2;
        }

        .balance {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 1rem 0;
            color: #00d4aa;
            text-shadow: 0 0 20px rgba(0, 212, 170, 0.5);
        }

        .pnl {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .pnl-positive { 
            color: #00d4aa; 
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .pnl-negative { 
            color: #ff6b6b; 
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
        }

        .wallet-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .wallet-btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            border: 2px solid #4a5568;
            color: #fff;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .topup-btn {
            border-color: #00d4aa;
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: #000;
        }

        .topup-btn:hover {
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.4);
        }

        .withdraw-btn {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #ff6b6b, #e55454);
            color: #fff;
        }

        .withdraw-btn:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .trading-form {
            background: rgba(0, 0, 0, 0.3);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.8rem;
            color: #a0aec0;
            font-size: 1rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            background: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 12px;
            padding: 1rem 1.2rem;
            color: #fff;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #00d4aa;
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.15);
            background: #3a4553;
        }

        .amount-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .amount-btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            border: 2px solid #4a5568;
            color: #fff;
            padding: 0.8rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .amount-btn:hover {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            border-color: #00d4aa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.3);
        }

        .trade-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .trade-btn {
            padding: 1.5rem;
            border: none;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .trade-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .trade-btn:hover::before {
            left: 100%;
        }

        .buy-btn {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
            box-shadow: 0 10px 25px rgba(0, 212, 170, 0.3);
        }

        .sell-btn {
            background: linear-gradient(135deg, #ff6b6b, #e55454);
            color: white;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }

        .trade-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 35px rgba(0, 0, 0, 0.4);
        }

        .positions {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 20px;
            margin-bottom: 1rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
        }

        .section-title {
            color: #00d4aa;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .position-item {
            background: rgba(45, 55, 72, 0.6);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border-left: 4px solid #00d4aa;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .position-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0, 212, 170, 0.2);
        }

        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .position-type {
            font-weight: bold;
            color: #00d4aa;
            font-size: 1.1rem;
        }

        .position-pnl {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .close-btn {
            background: linear-gradient(135deg, #ff6b6b, #e55454);
            border: none;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 1rem;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .close-btn:hover {
            background: linear-gradient(135deg, #e55454, #d63447);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.4s ease;
            z-index: 1000;
            font-weight: bold;
            font-size: 1.1rem;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff6b6b, #e55454);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 212, 170, 0.3);
            border-radius: 50%;
            border-top-color: #00d4aa;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .control-btn {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            border: 2px solid #4a5568;
            color: #fff;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            border-color: #00d4aa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 170, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1d29, #2d3748);
            padding: 2.5rem;
            border-radius: 25px;
            border: 2px solid #00d4aa;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.4s ease;
        }
        
        .modal-content-large {
            max-width: 800px;
        }

        @keyframes slideUp {
            from { 
                transform: translateY(50px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(0, 212, 170, 0.2);
        }

        .modal-header h2 {
            color: #00d4aa;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(0, 212, 170, 0.3);
        }

        .modal-header p {
            color: #a0aec0;
            font-size: 1rem;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: #a0aec0;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            transform: rotate(90deg);
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
        }

        .modal-btn-secondary {
            background: linear-gradient(135deg, #4a5568, #2d3748);
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .history-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 20px;
            margin-bottom: 1rem;
            border: 1px solid rgba(0, 212, 170, 0.2);
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            margin-bottom: 0.5rem;
            background: rgba(45, 55, 72, 0.3);
            border-radius: 10px;
            border-left: 3px solid;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(45, 55, 72, 0.6);
            transform: translateX(3px);
        }

        .history-deposit {
            border-left-color: #00d4aa;
        }

        .history-withdraw {
            border-left-color: #ff6b6b;
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .history-icon {
            font-size: 1.2rem;
        }

        .history-deposit .history-icon {
            color: #00d4aa;
        }

        .history-withdraw .history-icon {
            color: #ff6b6b;
        }

        .history-details {
            flex: 1;
        }

        .history-type {
            font-weight: bold;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-time {
            font-size: 0.8rem;
            color: #a0aec0;
        }

        .history-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .history-deposit .history-amount {
            color: #00d4aa;
        }

        .history-withdraw .history-amount {
            color: #ff6b6b;
        }

        /* -- NEW STYLES -- */
        .form-checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .form-checkbox-group input {
            width: auto;
        }

        .advanced-options {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .advanced-options.show {
            display: grid;
        }
        
        .trade-history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .trade-history-table th, .trade-history-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .trade-history-table th {
            color: #00d4aa;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
        }
        
        .stats-modal-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        .stats-modal-card {
            background: rgba(0,0,0,0.2);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
        }
        .stats-modal-title {
            font-size: 1rem;
            color: #a0aec0;
            margin-bottom: 0.5rem;
        }
        .stats-modal-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                padding: 0 1rem 1rem 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .current-price {
                font-size: 2rem;
            }
            
            .balance {
                font-size: 2rem;
            }
        }

        @media (max-width: 640px) {
            .price-info {
                flex-direction: column;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .amount-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                width: 95%;
                padding: 2rem;
            }
            
            .wallet-actions {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            .advanced-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>

    <!-- Header -->
    <div class="header">
        <h1>📈 TradeSim Pro</h1>
        <p>Simulator Trading Kripto Profesional</p>
    </div>

    <div class="container">
        <!-- Chart Section -->
        <div class="chart-section">
            <div class="price-header">
                <div class="price-info">
                    <div class="symbol-selector">
                        <div class="symbol" id="currentSymbol">BTCUSD</div>
                        <select class="coin-select" id="coinSelect" onchange="window.tradingApp.switchCoin(this.value)"></select>
                    </div>
                    <div class="current-price" id="currentPrice">
                        <span class="price-flicker-overlay" id="priceFlickerOverlay"></span>
                        \$50,000.00
                    </div>
                    <div class="price-change price-up" id="priceChange">+\$0.00 (0.00%)</div>
                </div>
                
                <!-- Control Buttons -->
                <div class="controls">
                    <button class="control-btn" onclick="openCreateCoinModal()">
                        <i class="fas fa-plus-circle"></i> Buat Koin
                    </button>
                    <button class="control-btn" onclick="openTradeHistoryModal()">
                        <i class="fas fa-book"></i> Riwayat Trade
                    </button>
                     <button class="control-btn" onclick="openStatsModal()">
                        <i class="fas fa-chart-bar"></i> Statistik
                    </button>
                    <button class="control-btn" onclick="resetPortfolio()">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button class="control-btn" onclick="saveProgress()">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-loading" id="chartLoading">
                    <span class="loading-spinner"></span>
                    Initializing Chart...
                </div>
                <div id="chartDiv" style="width: 100%; height: 100%; display: none;"></div>
                <div class="trade-activity" id="tradeActivity"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">📈 24h High</div>
                    <div class="stat-value" id="high24h">\$52,000</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">📉 24h Low</div>
                    <div class="stat-value" id="low24h">\$48,000</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">💹 Volume</div>
                    <div class="stat-value" id="volume24h">\$2.1B</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">📊 Positions</div>
                    <div class="stat-value" id="totalPositions">0</div>
                </div>
            </div>
        </div>

        <!-- Trading Panel -->
        <div class="trading-panel">
            <!-- Wallet -->
            <div class="wallet-section">
                <div class="wallet-content">
                    <h3><i class="fas fa-wallet"></i> Portfolio Balance</h3>
                    <div class="balance" id="balance">\$10,000.00</div>
                    <div class="pnl pnl-positive" id="totalPnL">P&L: \$0.00 (0.00%)</div>
                    
                    <div class="wallet-actions">
                        <button class="wallet-btn topup-btn" onclick="openTopUpModal()">
                            <i class="fas fa-plus"></i> Top Up
                        </button>
                        <button class="wallet-btn withdraw-btn" onclick="openWithdrawModal()">
                            <i class="fas fa-minus"></i> Withdraw
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transaction History -->
            <div class="history-section">
                <div class="section-title">
                    <i class="fas fa-history"></i> Transaction History
                </div>
                <div id="transactionHistory"></div>
            </div>

            <!-- Trading Form -->
            <div class="trading-form">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-dollar-sign"></i> Amount (USD)
                    </label>
                    <input type="number" class="form-input" id="tradeAmount" value="100" min="1" step="10">
                    <div class="amount-buttons">
                        <button class="amount-btn" onclick="setAmount(100)">$100</button>
                        <button class="amount-btn" onclick="setAmount(500)">$500</button>
                        <button class="amount-btn" onclick="setAmount(1000)">$1K</button>
                        <button class="amount-btn" onclick="setAmount(5000)">$5K</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-chart-line"></i> Leverage
                    </label>
                    <select class="form-input" id="leverage">
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="5">5x</option>
                        <option value="10">10x</option>
                        <option value="20">20x</option>
                        <option value="50">50x</option>
                    </select>
                </div>
                
                 <!-- NEW: Advanced Options -->
                <div class="form-group">
                    <div class="form-checkbox-group">
                        <input type="checkbox" id="useAdvanced" onchange="toggleAdvancedOptions()">
                        <label for="useAdvanced" style="cursor:pointer; color: #00d4aa;">Gunakan Opsi Lanjutan (TP/SL/Limit)</label>
                    </div>

                    <div class="advanced-options" id="advancedOptions">
                        <div>
                            <label class="form-label" style="font-size:0.8rem;">Take Profit</label>
                            <input type="number" class="form-input" id="takeProfit" placeholder="e.g. 51000">
                        </div>
                        <div>
                            <label class="form-label" style="font-size:0.8rem;">Stop Loss</label>
                            <input type="number" class="form-input" id="stopLoss" placeholder="e.g. 49000">
                        </div>
                        <div class="form-checkbox-group" style="grid-column: 1 / -1;">
                             <input type="checkbox" id="isLimitOrder">
                             <label for="isLimitOrder" style="cursor:pointer;">Jadikan Limit Order</label>
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <label class="form-label" style="font-size:0.8rem;">Harga Order</label>
                            <input type="number" class="form-input" id="limitPrice" placeholder="Harga eksekusi">
                        </div>
                    </div>
                </div>
                
                <div class="trade-buttons">
                    <button class="trade-btn buy-btn" onclick="executeTrade('buy')">
                        <i class="fas fa-arrow-up"></i> BUY LONG
                    </button>
                    <button class="trade-btn sell-btn" onclick="executeTrade('sell')">
                        <i class="fas fa-arrow-down"></i> SELL SHORT
                    </button>
                </div>
            </div>

            <!-- Positions -->
            <div class="positions">
                <div class="section-title">
                    <i class="fas fa-chart-pie"></i> Active Positions (<span id="activeCoinPositionsCount">0</span>)
                </div>
                <div id="positionsList"></div>
            </div>
            
            <!-- NEW: Pending Orders -->
            <div class="positions">
                <div class="section-title">
                    <i class="fas fa-hourglass-half"></i> Pending Orders (<span id="pendingOrdersCount">0</span>)
                </div>
                <div id="pendingOrdersList"></div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="topupModal"><div class="modal-content">...</div></div>
    <div class="modal" id="withdrawModal"><div class="modal-content">...</div></div>
    
    <!-- NEW: Create Coin Modal -->
    <div class="modal" id="createCoinModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('createCoinModal')"><i class="fas fa-times"></i></button>
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Buat Koin Kustom</h2>
                <p>Ciptakan aset kripto Anda sendiri!</p>
            </div>
            <div class="form-group">
                <label class="form-label">Simbol Koin (3-5 Huruf)</label>
                <input type="text" class="form-input" id="customCoinSymbol" placeholder="e.g. MYC" maxlength="5">
            </div>
            <div class="form-group">
                <label class="form-label">Harga Awal (USD)</label>
                <input type="number" class="form-input" id="customCoinPrice" value="100" min="0.0001" step="10">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('createCoinModal')">Batal</button>
                <button class="modal-btn modal-btn-primary" onclick="executeCreateCoin()">
                    <i class="fas fa-plus"></i> Ciptakan Koin
                </button>
            </div>
        </div>
    </div>
    
    <!-- NEW: Trade History Modal -->
    <div class="modal" id="tradeHistoryModal">
        <div class="modal-content modal-content-large">
            <button class="close-modal" onclick="closeModal('tradeHistoryModal')"><i class="fas fa-times"></i></button>
            <div class="modal-header">
                <h2><i class="fas fa-book"></i> Riwayat Perdagangan</h2>
                <p>Semua posisi yang telah ditutup</p>
            </div>
            <div id="tradeHistoryContent" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>
    
    <!-- NEW: Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('statsModal')"><i class="fas fa-times"></i></button>
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> Statistik Kinerja</h2>
                <p>Analisis performa trading Anda</p>
            </div>
            <div id="statsContent"></div>
        </div>
    </div>


    <!-- The rest of the modals (TopUp, Withdraw) should be here as in the original code -->
     <!-- Top Up Modal -->
    <div class="modal" id="topupModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('topupModal')">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Top Up Funds</h2>
                <p>Add money to your trading account</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Amount (USD)</label>
                <input type="number" class="form-input" id="topupAmount" value="1000" min="10" step="10">
                <div class="amount-buttons">
                    <button class="amount-btn" onclick="setModalAmount('topupAmount', 1000)">$1K</button>
                    <button class="amount-btn" onclick="setModalAmount('topupAmount', 5000)">$5K</button>
                    <button class="amount-btn" onclick="setModalAmount('topupAmount', 10000)">$10K</button>
                    <button class="amount-btn" onclick="setModalAmount('topupAmount', 25000)">$25K</button>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('topupModal')">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="executeTopUp()">
                    <i class="fas fa-plus"></i> Add Funds
                </button>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('withdrawModal')">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-header">
                <h2><i class="fas fa-minus-circle"></i> Withdraw Funds</h2>
                <p>Remove money from your trading account</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Amount (USD)</label>
                <input type="number" class="form-input" id="withdrawAmount" value="1000" min="10" step="10">
                <div style="font-size: 0.9rem; color: #a0aec0; margin-top: 0.5rem;">
                    Available: $<span id="availableBalance">0</span>
                </div>
                <div class="amount-buttons">
                    <button class="amount-btn" onclick="setModalAmount('withdrawAmount', 1000)">$1K</button>
                    <button class="amount-btn" onclick="setModalAmount('withdrawAmount', 5000)">$5K</button>
                    <button class="amount-btn" onclick="setWithdrawPercentage(50)">50%</button>
                    <button class="amount-btn" onclick="setWithdrawPercentage(100)">All</button>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn modal-btn-secondary" onclick="closeModal('withdrawModal')">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="executeWithdraw()" style="background: linear-gradient(135deg, #ff6b6b, #e55454);">
                    <i class="fas fa-minus"></i> Withdraw
                </button>
            </div>
        </div>
    </div>
    <script>
        let appInitialized = false;
        let chartLoadTimeout;
        
        function initializeApp() {
            if (appInitialized) return;
            
            if (typeof LightweightCharts !== 'undefined') {
                clearTimeout(chartLoadTimeout);
                document.getElementById('chartLoading').style.display = 'none';
                document.getElementById('chartDiv').style.display = 'block';
                appInitialized = true;
                window.tradingApp = new TradingSimulator();
            } else {
                chartLoadTimeout = setTimeout(initializeApp, 500);
            }
        }

        function generateMarketNoise() {
            const names = ["Alice", "Bob", "Charlie", "David", "Eva", "Frank", "Grace", "Henry", "Ivy", "Jack"];
            const randomName = names[Math.floor(Math.random() * names.length)];
            const action = Math.random() > 0.5 ? "bought" : "sold";
            const amount = (Math.random() * 1.5 + 0.01).toFixed(3);
            const coin = window.tradingApp ? window.tradingApp.activeCoinSymbol.replace("USD", "") : "BTC";
            return { name: randomName, action: action, amount: amount, coin: coin, time: new Date() };
        }

        class TradingSimulator {
            constructor() {
                this.initialCoins = ['BTCUSD', 'ETHUSD', 'XRPUSD', 'DOGEUSD', 'SOLUSD'];
                this.defaultCoinPrices = { 'BTCUSD': 50000, 'ETHUSD': 3000, 'XRPUSD': 0.5, 'DOGEUSD': 0.15, 'SOLUSD': 120 };
                this.marketNoiseInterval = null;
                this.orderCheckInterval = null;
                this.marketActivities = [];
                this.loadData();
                this.chart = null;
                this.candleSeries = null;
                this.priceIntervals = {};
                this.initAllCoinsPriceData();
                this.initChart();
                this.startAllPriceSimulations();
                this.startMarketNoiseSimulation();
                this.startOrderCheckLoop();
                this.updateUI();
                this.switchCoin(this.activeCoinSymbol);
            }

            loadData() {
                try {
                    const savedData = JSON.parse(localStorage.getItem('tradingSimData'));
                    if (savedData) {
                        this.balance = data.balance || 10000;
                        this.initialBalance = data.initialBalance || 10000;
                        this.activeCoinSymbol = data.activeCoinSymbol || 'BTCUSD';
                        this.availableCoins = data.availableCoins || [...this.initialCoins];
                        this.transactions = data.transactions || [];
                        this.coins = data.coins || {};
                        this.pendingOrders = data.pendingOrders || [];
                        this.tradeHistory = data.tradeHistory || [];
                        this.wins = data.wins || 0;
                        this.losses = data.losses || 0;
                        this.totalProfit = data.totalProfit || 0;
                        this.totalLoss = data.totalLoss || 0;
                        this.availableCoins.forEach(symbol => {
                            if (!this.coins[symbol]) this.coins[symbol] = this.createDefaultCoinData(symbol);
                        });
                    } else {
                        this.setDefaultData();
                    }
                } catch (error) {
                    console.error('Error loading data, using defaults:', error);
                    this.setDefaultData();
                }
            }

            setDefaultData() {
                this.balance = 10000;
                this.initialBalance = 10000;
                this.activeCoinSymbol = 'BTCUSD';
                this.availableCoins = [...this.initialCoins];
                this.transactions = [];
                this.coins = {};
                this.availableCoins.forEach(symbol => {
                    this.coins[symbol] = this.createDefaultCoinData(symbol);
                });
                this.pendingOrders = [];
                this.tradeHistory = [];
                this.wins = 0;
                this.losses = 0;
                this.totalProfit = 0;
                this.totalLoss = 0;
            }

            createDefaultCoinData(symbol, price) {
                const initialPrice = price || this.defaultCoinPrices[symbol] || 1;
                return {
                    currentPrice: initialPrice,
                    startPrice: initialPrice,
                    high24h: initialPrice,
                    low24h: initialPrice,
                    candlestickData: [],
                    positions: []
                };
            }

            saveData() {
                try {
                    // Clean chart lines before saving
                    const dataToSave = JSON.parse(JSON.stringify(this));
                    Object.values(dataToSave.coins).forEach(coin => {
                        coin.positions.forEach(pos => {
                            delete pos.chartLine;
                            delete pos.tpLine;
                            delete pos.slLine;
                        });
                    });
                     dataToSave.pendingOrders.forEach(order => {
                        delete order.chartLine;
                    });
                    delete dataToSave.chart;
                    delete dataToSave.candleSeries;
                    
                    localStorage.setItem('tradingSimData', JSON.stringify(dataToSave));
                    console.log('Data saved');
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            }
            
            // ... (topUp, withdraw, getAvailableBalance, updateTransactionHistory methods from original code) ...
            
            topUp(amount) {
                if (isNaN(amount) || amount <= 0) {
                    this.showNotification('❌ Please enter a valid amount!', 'error');
                    return false;
                }
                if (amount < 10) {
                    this.showNotification('❌ Minimum top up amount is \$10', 'error');
                    return false;
                }
                this.balance += amount;
                this.transactions.unshift({
                    id: Date.now(), type: 'deposit', amount: amount, timestamp: new Date(), balance: this.balance
                });
                if (this.transactions.length > 20) {
                    this.transactions = this.transactions.slice(0, 20);
                }
                this.showNotification(`💰 Successfully added $${amount.toFixed(2)} to your account!\nNew Balance: $${this.balance.toFixed(2)}`, 'success');
                this.updateUI();
                this.saveData();
                return true;
            }

            withdraw(amount) {
                if (isNaN(amount) || amount <= 0) {
                    this.showNotification('❌ Please enter a valid amount!', 'error');
                    return false;
                }
                if (amount < 10) {
                    this.showNotification('❌ Minimum withdrawal amount is \$10', 'error');
                    return false;
                }
                const marginUsed = Object.values(this.coins).reduce((sum, coin) => 
                    sum + coin.positions.reduce((subSum, pos) => subSum + pos.amount, 0), 0);
                const availableBalance = this.balance - marginUsed;
                if (amount > availableBalance) {
                    this.showNotification(`❌ Insufficient available balance!\nAvailable: $${availableBalance.toFixed(2)}\nMargin Used: $${marginUsed.toFixed(2)}`, 'error');
                    return false;
                }
                this.balance -= amount;
                this.transactions.unshift({
                    id: Date.now(), type: 'withdraw', amount: amount, timestamp: new Date(), balance: this.balance
                });
                if (this.transactions.length > 20) {
                    this.transactions = this.transactions.slice(0, 20);
                }
                this.showNotification(`💸 Successfully withdrew $${amount.toFixed(2)} from your account!\nNew Balance: $${this.balance.toFixed(2)}`, 'success');
                this.updateUI();
                this.saveData();
                return true;
            }

            getAvailableBalance() {
                const marginUsed = Object.values(this.coins).reduce((sum, coin) => 
                    sum + coin.positions.reduce((subSum, pos) => subSum + pos.amount, 0), 0);
                return this.balance - marginUsed;
            }

            updateTransactionHistory() {
                const container = document.getElementById('transactionHistory');
                if (this.transactions.length === 0) {
                    container.innerHTML = `<div style="text-align: center; color: #a0aec0; padding: 1rem;"><i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i><div style="font-size: 0.9rem;">No transactions yet</div></div>`;
                    return;
                }
                container.innerHTML = this.transactions.map(transaction => {
                    const isDeposit = transaction.type === 'deposit';
                    return `
                        <div class="history-item ${isDeposit ? 'history-deposit' : 'history-withdraw'}">
                            <div class="history-info">
                                <div class="history-icon"><i class="fas ${isDeposit ? 'fa-arrow-down' : 'fa-arrow-up'}"></i></div>
                                <div class="history-details">
                                    <div class="history-type">${isDeposit ? 'Deposit' : 'Withdraw'}</div>
                                    <div class="history-time">${this.getTimeAgo(transaction.timestamp)}</div>
                                </div>
                            </div>
                            <div class="history-amount">${isDeposit ? '+' : '-'}$${transaction.amount.toFixed(2)}</div>
                        </div>`;
                }).join('');
            }
            
            addCustomCoin(symbol, price) {
                symbol = symbol.toUpperCase() + 'USD';
                if(this.availableCoins.includes(symbol)) {
                    this.showNotification(`❌ Koin ${symbol} sudah ada!`, 'error');
                    return false;
                }
                if(symbol.length < 4 || symbol.length > 8) {
                     this.showNotification('❌ Simbol koin harus 3-5 huruf.', 'error');
                     return false;
                }
                if(isNaN(price) || price <= 0) {
                    this.showNotification('❌ Harga awal tidak valid.', 'error');
                    return false;
                }

                this.availableCoins.push(symbol);
                this.coins[symbol] = this.createDefaultCoinData(symbol, price);
                this.initAllCoinsPriceData(); // Re-init to generate history for new coin
                this.startPriceSimulationFor(symbol); // Start simulation for new coin
                this.updateCoinSelector();
                this.switchCoin(symbol);
                this.showNotification(`🎉 Koin kustom ${symbol} berhasil dibuat!`, 'success');
                this.saveData();
                return true;
            }
            
            updateCoinSelector() {
                const select = document.getElementById('coinSelect');
                select.innerHTML = this.availableCoins.map(s => `<option value="${s}">${s}</option>`).join('');
                select.value = this.activeCoinSymbol;
            }
            
            initAllCoinsPriceData() {
                const now = new Date();
                this.availableCoins.forEach(symbol => {
                    const coinData = this.coins[symbol];
                    if (!coinData.candlestickData || coinData.candlestickData.length === 0) {
                        const initialPrice = coinData.currentPrice;
                        coinData.candlestickData = [];
                        let lastClose = initialPrice;
                        for (let i = 100; i >= 0; i--) {
                            const time = new Date(now.getTime() - i * 60000);
                            const open = lastClose;
                            const volatility = (Math.random() - 0.48) * 0.05; // -2.4% to +2.6%
                            const close = open * (1 + volatility);
                            const high = Math.max(open, close) * (1 + Math.random() * 0.02);
                            const low = Math.min(open, close) * (1 - Math.random() * 0.02);
                            coinData.candlestickData.push({ time: time.getTime() / 1000, open, high, low, close });
                            lastClose = close;
                        }
                        coinData.currentPrice = coinData.candlestickData[coinData.candlestickData.length - 1].close;
                        coinData.startPrice = coinData.candlestickData[0].open;
                        coinData.high24h = Math.max(...coinData.candlestickData.map(c => c.high));
                        coinData.low24h = Math.min(...coinData.candlestickData.map(c => c.low));
                    }
                });
            }

            initChart() {
                const chartContainer = document.getElementById('chartDiv');
                chartContainer.innerHTML = '';
                this.chart = LightweightCharts.createChart(chartContainer, {
                    width: chartContainer.clientWidth, height: chartContainer.clientHeight,
                    layout: { backgroundColor: 'transparent', textColor: '#a0aec0' },
                    grid: { vertLines: { color: 'rgba(255, 255, 255, 0.1)' }, horzLines: { color: 'rgba(255, 255, 255, 0.1)' } },
                    crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
                    timeScale: { timeVisible: true, secondsVisible: false, borderColor: 'rgba(255, 255, 255, 0.2)' },
                    rightPriceScale: { borderColor: 'rgba(255, 255, 255, 0.2)' },
                });
                this.candleSeries = this.chart.addCandlestickSeries({
                    upColor: '#00d4aa', downColor: '#ff6b6b', borderUpColor: '#00d4aa',
                    borderDownColor: '#ff6b6b', wickUpColor: '#00d4aa', wickDownColor: '#ff6b6b',
                });
                this.candleSeries.setData(this.coins[this.activeCoinSymbol].candlestickData);
                this.drawAllChartLines();
                window.addEventListener('resize', () => {
                    if (this.chart) this.chart.applyOptions({ width: chartContainer.clientWidth, height: chartContainer.clientHeight });
                });
            }
            
            startAllPriceSimulations() {
                for (const symbol in this.priceIntervals) clearInterval(this.priceIntervals[symbol]);
                this.priceIntervals = {};
                this.availableCoins.forEach(symbol => this.startPriceSimulationFor(symbol));
            }
            
            startPriceSimulationFor(symbol) {
                 this.priceIntervals[symbol] = setInterval(() => this.simulatePrice(symbol), 2000);
            }
            
            startOrderCheckLoop() {
                if(this.orderCheckInterval) clearInterval(this.orderCheckInterval);
                this.orderCheckInterval = setInterval(() => this.checkPendingAndTpslOrders(), 1000);
            }

            // ... (startMarketNoiseSimulation, addMarketActivity, updateMarketActivityDisplay methods from original code) ...
            startMarketNoiseSimulation() {
                if (this.marketNoiseInterval) clearInterval(this.marketNoiseInterval);
                this.marketNoiseInterval = setInterval(() => {
                    if (Math.random() < 0.7) {
                        const activity = generateMarketNoise();
                        activity.coin = this.activeCoinSymbol.replace("USD", "");
                        this.addMarketActivity(activity);
                    }
                }, 2000);
            }

            addMarketActivity(activity) {
                this.marketActivities.unshift(activity);
                if (this.marketActivities.length > 10) this.marketActivities.pop();
                this.updateMarketActivityDisplay();
            }

            updateMarketActivityDisplay() {
                const container = document.getElementById('tradeActivity');
                if (!container) return;
                container.innerHTML = this.marketActivities.map(activity => `
                    <div class="trade-activity-item">
                        <span class="${activity.action === 'bought' ? 'trade-buy' : 'trade-sell'}">
                            ${activity.name} ${activity.action} ${activity.amount} ${activity.coin}
                        </span>
                        <div style="font-size: 0.7rem; opacity: 0.7; margin-top: 2px;">
                            ${new Date(activity.time).toLocaleTimeString()}
                        </div>
                    </div>`).join('');
            }
            
            simulatePrice(symbol) {
                const coinData = this.coins[symbol];
                const lastCandle = coinData.candlestickData[coinData.candlestickData.length - 1];
                const open = lastCandle.close;
                const direction = Math.random() > 0.5 ? 1 : -1;
                const volatility = (Math.random() * 0.005 + 0.001) + (Math.random() < 0.05 ? (Math.random() * 0.02 + 0.01) : 0);
                const close = open * (1 + (direction * volatility));
                const high = Math.max(open, close) * (1 + Math.random() * volatility * 0.5);
                const low = Math.min(open, close) * (1 - Math.random() * volatility * 0.5);
                
                const newCandle = { time: Math.floor(new Date().getTime() / 1000), open, high, low, close };
                coinData.candlestickData.push(newCandle);
                if (coinData.candlestickData.length > 150) coinData.candlestickData.shift();
                
                coinData.currentPrice = close;
                coinData.high24h = Math.max(coinData.high24h, high);
                coinData.low24h = Math.min(coinData.low24h, low);
                
                if (symbol === this.activeCoinSymbol && this.candleSeries) this.candleSeries.update(newCandle);
                this.updatePositionsPnL(symbol);
                if (symbol === this.activeCoinSymbol) this.updateUI();
                if (Math.random() < 0.05) this.saveData();
            }

            switchCoin(symbol) {
                if (!this.coins[symbol]) {
                    this.showNotification('Koin tidak ditemukan!', 'error');
                    return;
                }
                this.activeCoinSymbol = symbol;
                document.getElementById('currentSymbol').textContent = symbol;
                this.updateCoinSelector();
                this.initChart();
                this.updateUI();
                this.marketActivities.forEach(a => a.coin = symbol.replace("USD", ""));
                this.updateMarketActivityDisplay();
                this.saveData();
            }

            executeTrade(type) {
                const amount = parseFloat(document.getElementById('tradeAmount').value);
                const leverage = parseFloat(document.getElementById('leverage').value);
                const useAdvanced = document.getElementById('useAdvanced').checked;
                const isLimitOrder = useAdvanced && document.getElementById('isLimitOrder').checked;

                if (isNaN(amount) || amount <= 0 || amount < 10) {
                    this.showNotification('❌ Jumlah trade minimal \$10!', 'error');
                    return;
                }
                if (amount > this.balance) {
                    this.showNotification('❌ Saldo tidak cukup!', 'error');
                    return;
                }
                
                const takeProfit = useAdvanced ? parseFloat(document.getElementById('takeProfit').value) : 0;
                const stopLoss = useAdvanced ? parseFloat(document.getElementById('stopLoss').value) : 0;
                const limitPrice = isLimitOrder ? parseFloat(document.getElementById('limitPrice').value) : 0;

                const baseOrder = {
                    id: Date.now() + Math.random(), symbol: this.activeCoinSymbol, type, amount, leverage,
                    quantity: 0, timestamp: new Date(),
                    takeProfit: (takeProfit > 0) ? takeProfit : null,
                    stopLoss: (stopLoss > 0) ? stopLoss : null,
                };
                
                if (isLimitOrder) {
                    if (isNaN(limitPrice) || limitPrice <= 0) {
                        this.showNotification('❌ Harga limit order tidak valid!', 'error');
                        return;
                    }
                    baseOrder.entryPrice = limitPrice;
                    baseOrder.quantity = (amount * leverage) / limitPrice;
                    this.pendingOrders.push(baseOrder);
                    this.showNotification(`⌛ Limit ${type.toUpperCase()} order ditempatkan untuk ${baseOrder.symbol} @ $${limitPrice.toFixed(2)}`, 'success');
                } else {
                    const activeCoinData = this.coins[this.activeCoinSymbol];
                    baseOrder.entryPrice = activeCoinData.currentPrice;
                    baseOrder.quantity = (amount * leverage) / activeCoinData.currentPrice;
                    baseOrder.pnl = 0;
                    
                    activeCoinData.positions.push(baseOrder);
                    this.balance -= amount;
                    
                    this.addMarketActivity({ name: "You", action: type === 'buy' ? 'bought' : 'sold', amount: baseOrder.quantity.toFixed(6), coin: this.activeCoinSymbol.replace("USD", ""), time: new Date() });
                    this.triggerPriceFlicker(type);
                    this.showNotification(`🚀 ${type.toUpperCase()} position dibuka @ $${baseOrder.entryPrice.toFixed(2)}`, 'success');
                }
                
                this.updateUI();
                this.saveData();
            }

            checkPendingAndTpslOrders() {
                // Check Pending Orders
                this.pendingOrders = this.pendingOrders.filter(order => {
                    const currentPrice = this.coins[order.symbol].currentPrice;
                    let executed = false;
                    if (order.type === 'buy' && currentPrice <= order.entryPrice) executed = true;
                    if (order.type === 'sell' && currentPrice >= order.entryPrice) executed = true;

                    if (executed) {
                        const position = { ...order, pnl: 0, timestamp: new Date() };
                        this.coins[order.symbol].positions.push(position);
                        this.balance -= order.amount;
                        this.showNotification(`✅ Limit ${order.type} order untuk ${order.symbol} dieksekusi!`, 'success');
                        this.triggerPriceFlicker(order.type);
                         if(order.chartLine) this.candleSeries.removePriceLine(order.chartLine);
                        return false; // Remove from pending
                    }
                    return true; // Keep in pending
                });

                // Check TP/SL on Active Positions
                Object.values(this.coins).forEach(coinData => {
                    coinData.positions.forEach(pos => {
                        if (!pos.id) return;
                        
                        let closeReason = null;
                        if (pos.takeProfit) {
                            if (pos.type === 'buy' && coinData.currentPrice >= pos.takeProfit) closeReason = 'Take Profit';
                            if (pos.type === 'sell' && coinData.currentPrice <= pos.takeProfit) closeReason = 'Take Profit';
                        }
                        if (pos.stopLoss) {
                            if (pos.type === 'buy' && coinData.currentPrice <= pos.stopLoss) closeReason = 'Stop Loss';
                            if (pos.type === 'sell' && coinData.currentPrice >= pos.stopLoss) closeReason = 'Stop Loss';
                        }

                        if (closeReason) {
                            this.closePosition(pos.id, coinData.symbol, closeReason);
                        }
                    });
                });
                
                // Live update UI if active coin is affected
                this.updateUI();
            }
            
            cancelOrder(orderId) {
                const orderIndex = this.pendingOrders.findIndex(o => o.id === orderId);
                if (orderIndex === -1) return;
                
                const order = this.pendingOrders[orderIndex];
                 if (order.chartLine) this.candleSeries.removePriceLine(order.chartLine);
                
                this.pendingOrders.splice(orderIndex, 1);
                this.showNotification(`❌ Limit order untuk ${order.symbol} dibatalkan.`, 'success');
                this.updateUI();
                this.saveData();
            }

            updatePositionsPnL(symbol) {
                const coinData = this.coins[symbol];
                coinData.positions.forEach(position => {
                    const priceChange = coinData.currentPrice - position.entryPrice;
                    const direction = position.type === 'buy' ? 1 : -1;
                    position.pnl = (priceChange * direction * position.quantity);
                    
                    // Liquidation logic
                    const pnlPercent = (position.pnl / position.amount) * 100;
                    if(pnlPercent <= -95) { // Liquidation at -95% loss of margin
                        position.liquidated = true;
                        this.closePosition(position.id, symbol, 'Likuidasi');
                    }
                });
            }

            closePosition(positionId, symbol, reason = 'Manual') {
                const coinData = this.coins[symbol || this.activeCoinSymbol];
                const positionIndex = coinData.positions.findIndex(p => p.id === positionId);
                if (positionIndex === -1) return;

                const position = coinData.positions[positionIndex];
                const pnl = position.pnl;
                const pnlPercent = (pnl / position.amount) * 100;
                
                // Clear chart lines
                if (position.chartLine) this.candleSeries.removePriceLine(position.chartLine);
                if (position.tpLine) this.candleSeries.removePriceLine(position.tpLine);
                if (position.slLine) this.candleSeries.removePriceLine(position.slLine);
                
                const returnAmount = position.liquidated ? 0 : position.amount + pnl;
                this.balance += returnAmount;
                
                // Record trade history
                this.tradeHistory.unshift({
                    ...position,
                    closePrice: coinData.currentPrice,
                    closeTime: new Date(),
                    pnl: pnl,
                    reason: reason
                });
                if (this.tradeHistory.length > 50) this.tradeHistory.pop();
                
                // Update stats
                if(pnl >= 0) {
                    this.wins++;
                    this.totalProfit += pnl;
                } else {
                    this.losses++;
                    this.totalLoss += pnl; // pnl is already negative
                }

                coinData.positions.splice(positionIndex, 1);
                
                const resultText = position.liquidated ? 'LIKUIDASI' : (pnl >= 0 ? 'PROFIT' : 'LOSS');
                const emoji = position.liquidated ? '💥' : (pnl >= 0 ? '💰' : '📉');
                
                this.showNotification(
                    `${emoji} Posisi ${position.symbol} ditutup! (${reason})\n${resultText}: $${pnl.toFixed(2)}`,
                    pnl >= 0 && !position.liquidated ? 'success' : 'error'
                );
                
                this.updateUI();
                this.saveData();
            }
            
            drawAllChartLines() {
                if(!this.candleSeries) return;

                // Clear existing lines first
                this.coins[this.activeCoinSymbol].positions.forEach(pos => {
                    if (pos.chartLine) this.candleSeries.removePriceLine(pos.chartLine);
                    if (pos.tpLine) this.candleSeries.removePriceLine(pos.tpLine);
                    if (pos.slLine) this.candleSeries.removePriceLine(pos.slLine);
                });
                this.pendingOrders.forEach(order => {
                    if(order.chartLine) this.candleSeries.removePriceLine(order.chartLine);
                });

                // Draw lines for active positions of the current coin
                this.coins[this.activeCoinSymbol].positions.forEach(pos => {
                    pos.chartLine = this.createChartLine(pos.entryPrice, pos.type === 'buy' ? '#00bcd4' : '#ff9800', `Entry ${pos.type.toUpperCase()}`);
                    if (pos.takeProfit) pos.tpLine = this.createChartLine(pos.takeProfit, '#4caf50', 'TP');
                    if (pos.stopLoss) pos.slLine = this.createChartLine(pos.stopLoss, '#f44336', 'SL');
                });
                
                // Draw lines for pending orders of the current coin
                this.pendingOrders.forEach(order => {
                    if(order.symbol === this.activeCoinSymbol) {
                       order.chartLine = this.createChartLine(order.entryPrice, '#9e9e9e', `Limit ${order.type.toUpperCase()}`, 'dotted');
                    }
                });
            }

            createChartLine(price, color, title, style = 'solid') {
                const lineStyle = {
                    'solid': LightweightCharts.LineStyle.Solid,
                    'dotted': LightweightCharts.LineStyle.Dotted,
                    'dashed': LightweightCharts.LineStyle.Dashed,
                }[style];

                return this.candleSeries.createPriceLine({
                    price: price,
                    color: color,
                    lineWidth: 2,
                    lineStyle: lineStyle,
                    axisLabelVisible: true,
                    title: title,
                });
            }

            updateUI() {
                this.updateCoinSelector();
                const activeCoinData = this.coins[this.activeCoinSymbol];
                if (!activeCoinData) return;
                
                document.getElementById('currentPrice').childNodes[2].nodeValue = `$${activeCoinData.currentPrice.toFixed(activeCoinData.currentPrice > 10 ? 2 : 6)}`;
                
                const priceChange = activeCoinData.currentPrice - activeCoinData.startPrice;
                const priceChangePercent = (priceChange / activeCoinData.startPrice) * 100;
                const priceChangeEl = document.getElementById('priceChange');
                priceChangeEl.className = `price-change ${priceChange >= 0 ? 'price-up' : 'price-down'}`;
                priceChangeEl.textContent = `${priceChange >= 0 ? '+' : ''}$${priceChange.toFixed(2)} (${priceChangePercent.toFixed(2)}%)`;

                const totalPnL = Object.values(this.coins).reduce((sum, coin) => sum + coin.positions.reduce((s, pos) => s + pos.pnl, 0), 0);
                const totalBalance = this.balance + totalPnL;
                const totalPnLPercent = this.initialBalance > 0 ? ((totalBalance - this.initialBalance) / this.initialBalance) * 100 : 0;
                
                document.getElementById('balance').textContent = `$${totalBalance.toFixed(2)}`;
                const pnlElement = document.getElementById('totalPnL');
                pnlElement.textContent = `P&L: $${totalPnL.toFixed(2)} (${totalPnLPercent.toFixed(2)}%)`;
                pnlElement.className = `pnl ${totalPnL >= 0 ? 'pnl-positive' : 'pnl-negative'}`;

                document.getElementById('high24h').textContent = `$${activeCoinData.high24h.toFixed(activeCoinData.high24h > 10 ? 2 : 6)}`;
                document.getElementById('low24h').textContent = `$${activeCoinData.low24h.toFixed(activeCoinData.low24h > 10 ? 2 : 6)}`;
                document.getElementById('volume24h').textContent = `$${((Math.random() * 5 + 1) * activeCoinData.currentPrice / 10000).toFixed(1)}B`;
                document.getElementById('totalPositions').textContent = Object.values(this.coins).reduce((acc, c) => acc + c.positions.length, 0);

                document.getElementById('availableBalance').textContent = this.getAvailableBalance().toFixed(2);

                this.updatePositionsList();
                this.updatePendingOrdersList();
                this.updateTransactionHistory();
                this.drawAllChartLines();
            }

            updatePositionsList() {
                const container = document.getElementById('positionsList');
                const activeCoinPositions = this.coins[this.activeCoinSymbol].positions;
                document.getElementById('activeCoinPositionsCount').textContent = activeCoinPositions.length;

                if (activeCoinPositions.length === 0) {
                    container.innerHTML = `<div style="text-align: center; color: #a0aec0; padding: 2rem;"><i class="fas fa-inbox" style="font-size: 3rem; opacity: 0.5;"></i><div>No active positions</div></div>`;
                    return;
                }
                container.innerHTML = activeCoinPositions.map(position => {
                    const pnlClass = position.pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
                    const pnlPercent = (position.pnl / position.amount) * 100;
                    return `
                        <div class="position-item">
                            <div class="position-header">
                                <div class="position-type">${position.type === 'buy' ? '🚀' : '📉'} ${position.type.toUpperCase()} ${position.leverage}x</div>
                                <div class="position-pnl ${pnlClass}">$${position.pnl.toFixed(2)}</div>
                            </div>
                            <div style="font-size: 0.9rem; color: #a0aec0; margin-bottom: 0.8rem;">
                                <span>${position.quantity.toFixed(6)} ${position.symbol.replace('USD','')} @ $${position.entryPrice.toFixed(2)}</span>
                            </div>
                            ${ position.takeProfit ? `<div style="font-size: 0.8rem; color: #4caf50;">TP: $${position.takeProfit.toFixed(2)}</div>` : '' }
                            ${ position.stopLoss ? `<div style="font-size: 0.8rem; color: #f44336;">SL: $${position.stopLoss.toFixed(2)}</div>` : '' }
                            <button class="close-btn" onclick="window.tradingApp.closePosition(${position.id}, '${position.symbol}')"><i class="fas fa-times"></i> Close Position</button>
                        </div>
                    `;
                }).join('');
            }
            
             updatePendingOrdersList() {
                const container = document.getElementById('pendingOrdersList');
                const activeCoinOrders = this.pendingOrders.filter(o => o.symbol === this.activeCoinSymbol);
                document.getElementById('pendingOrdersCount').textContent = activeCoinOrders.length;

                if (activeCoinOrders.length === 0) {
                    container.innerHTML = `<div style="text-align: center; color: #a0aec0; padding: 2rem;"><i class="fas fa-inbox" style="font-size: 3rem; opacity: 0.5;"></i><div>No pending orders</div></div>`;
                    return;
                }
                container.innerHTML = activeCoinOrders.map(order => `
                    <div class="position-item" style="border-left-color: #9e9e9e;">
                        <div class="position-header">
                            <div class="position-type" style="color: #9e9e9e;">LIMIT ${order.type.toUpperCase()}</div>
                        </div>
                        <div style="font-size: 0.9rem; color: #a0aec0;">
                            <span>${order.quantity.toFixed(6)} ${order.symbol.replace('USD','')} @ $${order.entryPrice.toFixed(2)}</span>
                        </div>
                        <button class="close-btn" onclick="window.tradingApp.cancelOrder(${order.id})"><i class="fas fa-ban"></i> Cancel Order</button>
                    </div>
                `).join('');
            }
            
            // ... (getTimeAgo, showNotification, triggerPriceFlicker, resetPortfolio methods from original code) ...
            getTimeAgo(timestamp) {
                const diff = new Date() - new Date(timestamp);
                const seconds = Math.floor(diff / 1000), minutes = Math.floor(seconds / 60), hours = Math.floor(minutes / 60), days = Math.floor(hours / 24);
                if (days > 0) return `${days}d ago`; if (hours > 0) return `${hours}h ago`; if (minutes > 0) return `${minutes}m ago`;
                return 'Just now';
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.innerHTML = message.replace(/\n/g, '<br>');
                notification.className = `notification ${type === 'error' ? 'error' : ''} show`;
                setTimeout(() => notification.classList.remove('show'), 4000);
            }

            triggerPriceFlicker(type) {
                const flickerOverlay = document.getElementById('priceFlickerOverlay');
                flickerOverlay.style.animation = 'none'; flickerOverlay.offsetHeight;
                flickerOverlay.className = `price-flicker-overlay price-flicker-${type}`;
                flickerOverlay.style.animation = 'flicker-fade 0.5s ease-out forwards';
            }
            
             resetPortfolio() {
                if (confirm('Are you sure you want to reset your entire portfolio? This cannot be undone!')) {
                    Object.values(this.priceIntervals).forEach(clearInterval);
                    clearInterval(this.marketNoiseInterval);
                    clearInterval(this.orderCheckInterval);
                    localStorage.removeItem('tradingSimData');
                    this.setDefaultData();
                    this.initAllCoinsPriceData();
                    this.startAllPriceSimulations();
                    this.startMarketNoiseSimulation();
                    this.startOrderCheckLoop();
                    this.switchCoin('BTCUSD'); // Resets chart and UI
                    this.showNotification('✅ Portfolio reset successfully!', 'success');
                }
            }
            
            renderTradeHistory() {
                const container = document.getElementById('tradeHistoryContent');
                if (this.tradeHistory.length === 0) {
                    container.innerHTML = `<div style="text-align: center; color: #a0aec0; padding: 2rem;">No closed trades yet.</div>`;
                    return;
                }
                container.innerHTML = `
                    <table class="trade-history-table">
                        <thead><tr><th>Symbol</th><th>Type</th><th>P&L ($)</th><th>Entry</th><th>Exit</th><th>Reason</th><th>Date</th></tr></thead>
                        <tbody>
                            ${this.tradeHistory.map(t => {
                                const pnlClass = t.pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
                                return `<tr>
                                    <td>${t.symbol}</td>
                                    <td>${t.type.toUpperCase()} ${t.leverage}x</td>
                                    <td class="${pnlClass}">${t.pnl.toFixed(2)}</td>
                                    <td>$${t.entryPrice.toFixed(2)}</td>
                                    <td>$${t.closePrice.toFixed(2)}</td>
                                    <td>${t.reason}</td>
                                    <td>${new Date(t.closeTime).toLocaleString()}</td>
                                </tr>`
                            }).join('')}
                        </tbody>
                    </table>`;
            }
            
            renderStats() {
                const container = document.getElementById('statsContent');
                const totalTrades = this.wins + this.losses;
                const winRate = totalTrades > 0 ? (this.wins / totalTrades * 100).toFixed(1) : 0;
                const avgProfit = this.wins > 0 ? (this.totalProfit / this.wins).toFixed(2) : 0;
                const avgLoss = this.losses > 0 ? (this.totalLoss / this.losses).toFixed(2) : 0;
                const profitFactor = this.totalLoss !== 0 ? Math.abs(this.totalProfit / this.totalLoss).toFixed(2) : '∞';
                
                container.innerHTML = `
                    <div class="stats-modal-grid">
                        <div class="stats-modal-card"><div class="stats-modal-title">Total Trades</div><div class="stats-modal-value">${totalTrades}</div></div>
                        <div class="stats-modal-card"><div class="stats-modal-title">Win Rate</div><div class="stats-modal-value" style="color:${winRate >= 50 ? '#00d4aa':'#ff6b6b'};">${winRate}%</div></div>
                        <div class="stats-modal-card"><div class="stats-modal-title">Total P&L</div><div class="stats-modal-value ${this.totalProfit + this.totalLoss >= 0 ? 'pnl-positive':'pnl-negative'}">$${(this.totalProfit + this.totalLoss).toFixed(2)}</div></div>
                        <div class="stats-modal-card"><div class="stats-modal-title">Profit Factor</div><div class="stats-modal-value">${profitFactor}</div></div>
                        <div class="stats-modal-card"><div class="stats-modal-title">Avg. Profit</div><div class="stats-modal-value pnl-positive">$${avgProfit}</div></div>
                        <div class="stats-modal-card"><div class="stats-modal-title">Avg. Loss</div><div class="stats-modal-value pnl-negative">$${avgLoss}</div></div>
                    </div>
                `;
            }
        }

        // Global functions
        function setAmount(a) { document.getElementById('tradeAmount').value = a; }
        function setModalAmount(id, a) { document.getElementById(id).value = a; }
        function setWithdrawPercentage(p) { if(window.tradingApp) { const a = (window.tradingApp.getAvailableBalance() * p) / 100; document.getElementById('withdrawAmount').value = Math.floor(a); } }
        function executeTrade(t) { if(window.tradingApp) window.tradingApp.executeTrade(t); }
        function resetPortfolio() { if(window.tradingApp) window.tradingApp.resetPortfolio(); }
        function saveProgress() { if(window.tradingApp) { window.tradingApp.saveData(); window.tradingApp.showNotification('💾 Progress saved!', 'success'); } }
        
        function toggleAdvancedOptions() {
            document.getElementById('advancedOptions').classList.toggle('show', document.getElementById('useAdvanced').checked);
        }

        // Modal functions
        function openModal(id) { document.getElementById(id).classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        function openTopUpModal() { openModal('topupModal'); document.getElementById('topupAmount').focus(); }
        function openWithdrawModal() { if(window.tradingApp) document.getElementById('availableBalance').textContent = window.tradingApp.getAvailableBalance().toFixed(2); openModal('withdrawModal'); document.getElementById('withdrawAmount').focus(); }
        function openCreateCoinModal() { openModal('createCoinModal'); }
        function openTradeHistoryModal() { if(window.tradingApp) window.tradingApp.renderTradeHistory(); openModal('tradeHistoryModal'); }
        function openStatsModal() { if(window.tradingApp) window.tradingApp.renderStats(); openModal('statsModal'); }
        
        function executeTopUp() { const a = parseFloat(document.getElementById('topupAmount').value); if(window.tradingApp && window.tradingApp.topUp(a)) { closeModal('topupModal'); document.getElementById('topupAmount').value = 1000; } }
        function executeWithdraw() { const a = parseFloat(document.getElementById('withdrawAmount').value); if(window.tradingApp && window.tradingApp.withdraw(a)) { closeModal('withdrawModal'); document.getElementById('withdrawAmount').value = 1000; } }
        function executeCreateCoin() { const s = document.getElementById('customCoinSymbol').value; const p = parseFloat(document.getElementById('customCoinPrice').value); if(window.tradingApp && window.tradingApp.addCustomCoin(s, p)) closeModal('createCoinModal'); }

        window.onclick = function(e) { if(e.target.classList.contains('modal')) e.target.classList.remove('show'); }
        document.addEventListener('DOMContentLoaded', initializeApp);
        setTimeout(() => { if (!appInitialized) initializeApp(); }, 2000);
    </script>
</body>
</html>
